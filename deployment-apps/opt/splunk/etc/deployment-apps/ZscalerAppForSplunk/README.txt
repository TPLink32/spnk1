***************************************************************
Zscaler App for Splunk
***************************************************************

This app is to be used in conjunction with Zscaler Nanolog Streaming Service. It 
is used to parse the logs generated by the Zscaler NSS. 

How it works:
Zscaler weblogs are generated as and when the user traffic is processed. These
logs are sent to the Nanolog server assigned to the organization for storage.
A copy of the logs is sent to Nanolog Streaming Server over a secure connection
in a compressed format. The Nanolog Streaming Server then transforms the logs
into Common Information Model format and sends it to Splunk as raw TCP stream.


How to Use:
The Zscaler NSS sends the logs over raw TCP. You need to do the following:
a) Go to Manager > Data Inputs > TCP > New
b) Specify the TCP Port. This will be the same port to which the logs are sent from the NSS
c) Specify the Source Type as "zscalerweblogs"
d) Click on More Settings and set the index to zscalerlogs_index

Now, configure Zscaler to send logs in CIM format.
a) In the Zscaler Administration Console, go to Administration > Alerts & Notifications >
Nanolog Streaming Service. It is assumed that the Nanolog Streaming Server is already 
registered and running
b) Click on Edit > Add Feed. Specify the IP and port of Splunk as configured in above 
steps.
c) Configure the CIM format - either using the preset (if available) or using the example below. 
d) Save & Activate the changes. 


Sample CIM Format:
%d{yy}-%02d{mth}-%02d{dd} %02d{hh}:%02d{mm}:%02d{ss} %s{tz}\treason=%s{reason}\t
event_id=%d{recordid}\tprotocol=%s{proto}\taction=%s{action}\ttransactionsize=%d{totalsize}\t
responsesize=%d{respsize}\trequestsize=%d{reqsize}\turlcategory=%s{urlcat}\tserverip=%s{sip}\t
clienttranstime=%d{ctime}\trequestmethod=%s{reqmethod}\trefererURL=%s{referer}\tuseragent=%s{ua}\t
product=NSS\tlocation=%s{location}\tClientIP=%s{cip}\tstatus=%s{respcode}\tuser=%s{login}\t
url=%s{url}\tvendor=Zscaler\thostname=%s{host}\tclientpublicIP=%s{cintip}\t
threatcategory=%s{malwarecat}\tthreatname=%s{threatname}\tfiletype=%s{filetype}\t
appname=%s{appname}\tpagerisk=%d{riskscore}\tdepartment=%s{dept}\turlsupercategory=%s{urlsupercat}\t
appclass=%s{appclass}\tdlpengine=%s{dlpeng}\turlclass=%s{urlclass}\tthreatclass=%s{malwareclass}\t
dlpdictionaries=%s{dlpdict}\tfileclass=%s{fileclass}\tbwthrottle=%s{bwthrottle}\t
servertranstime=%d{stime}\n


Please refer to the Zscaler NSS documentation for descriptive steps. Feel free to redirect any
questions to Zscaler Support using the Support form in your admin console.
